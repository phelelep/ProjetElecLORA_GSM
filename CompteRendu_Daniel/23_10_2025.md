# ğŸ“ Compte Rendu â€” CEBAN Daniel  
## SÃ©ance du 23/10/2025

---

## ğŸ”§ Outils utilisÃ©s
- **ESP32 Heltec LoRa** â€“ MicrocontrÃ´leur principal du systÃ¨me.  
- **SIM7000G** â€“ Module GSM / NB-IoT / LTE pour la communication mobile.  
- **Arduino IDE** â€“ Logiciel de programmation pour cartes Ã©lectroniques, utilisÃ© pour programmer lâ€™ESP32.

---

## ğŸ¯ Objectifs de la sÃ©ance
- Connecter le module **ESP32** au module **SIM7000G** et Ã©tablir la communication entre les deux avec le code fourni par lâ€™Ã©quipe prÃ©cÃ©dente.  
- Tester et amÃ©liorer le code existant.  
- Comprendre le fonctionnement des bibliothÃ¨ques utilisÃ©es et optimiser lâ€™usage du modem.

---

## âš¡ Ã‰tapes de la sÃ©ance

### 1. CÃ¢blage ESP32 â†” SIM7000G
Il est essentiel de bien connecter les broches **RX/TX** entre lâ€™ESP32 et le module SIM7000G.  
> âš ï¸ Sur le module BK-SIM7000G, les connexions RX et TX doivent Ãªtre inversÃ©es par rapport Ã  lâ€™ESP32 (principe de communication sÃ©rie).  

Le **PWRKEY** du SIM7000G doit Ã©galement Ãªtre connectÃ© pour permettre lâ€™allumage et lâ€™extinction du module.

D'aprÃ¨s le DATASHEET du 7000G

PWRKEY 
- Default status : DI,P
- Description :System power on/off control nput, active low. The efficient input level must be below 0.5V.
- Comment - The level is 0.8V when this PIN is floating; 



Explication : 
Par dÃ©faut, le PWRKEY est considÃ©rÃ© HIGH lorsquâ€™il nâ€™est pas connectÃ© (flottant). Le module reste Ã©teint.
Pour allumer le module, il faut tirer la broche LOW (~0â€¯V) pendant ~1 seconde, puis la relÃ¢cher (retour Ã  HIGH).
Pour lâ€™Ã©teindre, mÃªme principe : on met LOW pendant ~1 seconde.

le SIM7000G a une rÃ©sistance internet qui permet d'avor un tension petite <0.5V Ã  la broche PWRKEY

Donc on va le brancher Ã  la broche 3,3 pour pouvoir agir dessus

par la suite dans notre code on va afaire dÃ©marrer le modem en utlisant le PWRKEY en lui donnat une impulsion pendant 300ms

```
pinMode(PWR_PIN, OUTPUT);
digitalWrite(PWR_PIN, HIGH);
delay(300);
digitalWrite(PWR_PIN, LOW);
```


![ESP32 pins layout](../Images/SIM7000pins.jpeg)  
![SIM7000G pins explication](../Images/SIM7000G_pins_Explication.png)

![Notre montage cÃ¢ble](../Images/SIM7000_ESP32_cable.heic)


---

### 2. Importation et comprÃ©hension du code dans Arduino IDE
Le code fourni par lâ€™Ã©quipe prÃ©cÃ©dente utilise la bibliothÃ¨que **TinyGSM**, qui simplifie grandement la communication avec le modem.  

#### La bibliothÃ¨que TinyGSM
- Permet dâ€™Ã©tablir des connexions GPRS / LTE.  
- Permet lâ€™envoi et la rÃ©ception de SMS.  
- Permet de passer des appels (selon le module).  
- OptimisÃ©e pour les cartes Ã  faible mÃ©moire comme lâ€™ESP32.  

#### Structure du code
a. **Configuration et initialisation du modem**

define TINY_GSM_MODEM_SIM7000
define TINY_GSM_RX_BUFFER 1024
define SerialAT Serial1
define DUMP_AT_COMMANDS
define GSM_PIN ""
define SMS_TARGET "+33645218132"

b. **parametre rÃ©seau** 

const char apn[] = "sl2sfr";
const char gprsUser[] = "";
const char gprsPass[] = "";

c. **Initialisation du modem**

SerialAT.begin(UART_BAUD, SERIAL_8N1, PIN_RX, PIN_TX);
modem.restart(); // redÃ©marrage du modem pour assurer un Ã©tat propre

d. **Choix des modes rÃ©seau** 

modem.sendAT("+CFUN=0");      // DÃ©sactive temporairement le modem
modem.setNetworkMode(2);      // Mode automatique
modem.setPreferredMode(1);    // PrioritÃ© au mode CAT-M
modem.sendAT("+CFUN=1");      // RÃ©active le modem

e. **Connexion GPRS et envoi de SMS**

modem.gprsConnect(apn, gprsUser, gprsPass);
modem.sendSMS(SMS_TARGET, String("Hello from ") + imei);

f. **Mode sommeil profond**

modem.poweroff();
esp_deep_sleep_start();

Permet dâ€™Ã©teindre le modem et mettre lâ€™ESP32 en sommeil pour Ã©conomiser lâ€™Ã©nergie.

---

### 3. TÃ©lÃ©chargement et test du code

- Importer le code dans Arduino IDE.
- Installer les bibliotheques necessaires
- Programmer lâ€™ESP32 et tester la communication avec le SIM7000G.

---

### 4. Analyse et correction du code

Identifier les erreurs ou parties Ã  amÃ©liorer.

Adapter les paramÃ¨tres rÃ©seau ou les pins si nÃ©cessaire.

Optimiser la gestion de lâ€™Ã©nergie (mode sommeil profond).


---

### Conclusion

La bibliothÃ¨que TinyGSM est essentielle pour simplifier la communication UART avec le SIM7000G.

Le cÃ¢blage RX/TX et PWRKEY est crucial pour le bon fonctionnement du module.

La mise en sommeil profond permet dâ€™Ã©conomiser lâ€™Ã©nergie lors des phases dâ€™inactivitÃ©.